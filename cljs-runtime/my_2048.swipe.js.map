{"version":3,"sources":["my_2048/swipe.cljs"],"mappings":"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","names":["my-2048.swipe/one-touch?","js/module$node_modules$rxjs$dist$cjs$index.filter","t","my-2048.swipe/prevent-def","p1__11325#","js/module$node_modules$rxjs$dist$cjs$index.tap","my-2048.swipe/get-xy","event","touches","cljs.core._EQ_","point","my-2048.swipe/log","msg","cljs.core.println","my-2048.swipe/get-direction","dx","dy","Math/abs","my-2048.swipe/arrowSwipe","js/module$node_modules$rxjs$dist$cjs$index.fromEvent","js/document","js/module$node_modules$rxjs$dist$cjs$index.map","my-2048.utils/arrow-direction","my-2048.swipe/touchSwipe","el","p1__11326#","get-stream","G__11327","touch-start","touch-move","touch-end","changedDirection","cljs.core.atom","is-growing?","x0","y0","pt","nt","vec__11328","cljs.core.nth","vec__11331","px","py","nx","ny","dpx","dpy","dnx","dny","swipe-pipe","ts","touch0","cljs.core/println","p__11334","vec__11335","_","js/module$node_modules$rxjs$dist$cjs$index.pairwise","p__11338","vec__11339","vec__11342","vec__11345","old-direction","new-direction","cljs.core.swap_BANG_","cljs.core/deref","js/module$node_modules$rxjs$dist$cjs$index.takeWhile","p__11348","vec__11349","vec__11352","vec__11355","p__11358","vec__11359","vec__11362","vec__11365","cljs.core.not_EQ_","js/module$node_modules$rxjs$dist$cjs$index.takeUntil","js/module$node_modules$rxjs$dist$cjs$index.takeLast","p__11368","vec__11369","vec__11372","direction","drag","js/module$node_modules$rxjs$dist$cjs$index.switchMap"],"sourcesContent":["(ns my-2048.swipe\n    (:require \n      [rxjs :as rx]\n      [my-2048.utils :as u]))\n\n(def one-touch?\n  (rx/filter (fn [t] (== t.touches.length 1))))\n\n(def prevent-def \n  (rx/tap #(do (.preventDefault %1))))\n\n(defn get-xy [event] \n  (let [\n    touches (if (= event.type \"touchend\") \n                event.changedTouches\n                event.touches)\n    point (aget touches 0)]\n    [point.pageX point.pageY]))\n    \n(defn log [msg]\n  (fn [event] (println msg (get-xy event))))\n\n(defn get-direction [dx dy]\n  (cond \n    (>= (Math/abs dx) (Math/abs dy))\n      (if (> dx 0) :right :left)\n    (< (Math/abs dx) (Math/abs dy))\n      (if (> dy 0) :up :down)))\n\n(defn arrowSwipe []\n  (.pipe (rx/fromEvent js/document \"keydown\")\n   (rx/map (fn [event] (u/arrow-direction event.key)))))\n\n(defn touchSwipe [el]\n    (let [ \n        get-stream  #(prevent-def (rx/fromEvent el %))\n        touch-start (get-stream \"touchstart\")\n        touch-move  (get-stream \"touchmove\")\n        touch-end   (get-stream \"touchend\")\n        changedDirection (atom 0)\n        is-growing? (fn [x0 y0 pt nt]\n                      (let [[px py] pt\n                            [nx ny] nt\n                            dpx (Math/abs (- px x0))\n                            dpy (Math/abs (- y0 py))\n                            dnx (Math/abs (- nx x0))\n                            dny (Math/abs (- y0 ny))]\n                          (and (>= dnx dpx) (>= dny dpy))))\n        swipe-pipe  (fn [ts]\n                      (let [\n                        touch0 (aget ts.touches 0)\n                        x0 touch0.pageX\n                        y0 touch0.pageY] \n                        (.pipe \n                            touch-move\n                            (rx/tap println)\n                            one-touch?\n                            (rx/map get-xy)\n                            (rx/map (fn [[nx ny] _]\n                                      [[nx ny] (get-direction (- nx x0) (- y0 ny))]))\n                            (rx/pairwise)\n                            (rx/tap (fn [[[pt old-direction] [nt new-direction]] _]\n                                        (swap! \n                                          changedDirection \n                                          #(if (and (zero? @changedDirection) (= old-direction new-direction)) 0 1))))\n                            (rx/takeWhile \n                                (fn [[[pt old-direction] [nt new-direction]] _]\n                                        (is-growing? x0 y0 pt nt)))\n                            (rx/takeWhile                            \n                                (fn [[[pt old-direction] [nt new-direction]] _]\n                                  (or (= old-direction new-direction)\n                                      (and (not= old-direction new-direction) (= @changedDirection 1)))))\n                            (rx/takeUntil touch-end)\n                            (rx/takeLast 1)\n                            ;; (rx/last)\n                            (rx/map (fn [[_ [_ direction]] _ _] direction))\n                        )))   \n        drag  (.pipe touch-start \n                  one-touch?\n                  (rx/tap #(println \"ololo\"))\n                  (rx/switchMap swipe-pipe))\n      ]    \n    ;; (.subscribe (.pipe swipe-pipe) println)\n    (.subscribe touch-move println)\n    ;; (.subscribe touch-start #(println \"Swipe started\"))\n    drag\n))"]}